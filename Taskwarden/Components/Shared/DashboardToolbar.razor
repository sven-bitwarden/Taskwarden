@using Taskwarden.Models

<header class="toolbar">
    <div class="toolbar-left">
        <span class="toolbar-brand">
            <i class="fa-solid fa-shield-halved toolbar-brand-icon"></i>
            TaskWarden
        </span>
        @if (GitHubLogin is not null || JiraDisplayName is not null)
        {
            <span class="toolbar-divider"></span>
            <span class="toolbar-identity">
                @if (JiraDisplayName is not null)
                {
                    <span class="toolbar-identity-item">
                        <i class="fa-brands fa-jira" style="color: #2684ff;"></i> @JiraDisplayName
                    </span>
                }
                @if (JiraDisplayName is not null && GitHubLogin is not null)
                {
                    <span class="toolbar-identity-sep">&middot;</span>
                }
                @if (GitHubLogin is not null)
                {
                    <span class="toolbar-identity-item">
                        <i class="fa-brands fa-github" style="color: #8b949e;"></i> @GitHubLogin
                    </span>
                }
            </span>
        }
    </div>

    <div class="toolbar-right">
        @if (ActiveSprint is not null)
        {
            <span class="toolbar-sprint">
                <i class="fa-solid fa-person-running"></i>
                <span class="toolbar-sprint-name">@ActiveSprint.Name</span>
                <span class="toolbar-sprint-dates">@ActiveSprint.StartDate.ToString("MMM d") â€“ @ActiveSprint.EndDate.ToString("MMM d")</span>
            </span>
            <span class="toolbar-divider"></span>
        }

        @if (WorkItems.Count > 0)
        {
            <div class="toolbar-actions">
                <CompletedWorkModal DoneItems="@DoneItems" />
                <StandupSummaryModal WorkItems="@WorkItems" />
            </div>
            <span class="toolbar-divider"></span>
        }

        <div class="toolbar-refresh">
            @if (LastRefreshed.HasValue)
            {
                <span class="toolbar-timestamp">@FormatTimeAgo(LastRefreshed.Value)</span>
            }
            <RefreshButton IsRefreshing="@IsLoading" />
        </div>
    </div>
</header>

@code {
    [Parameter]
    public IReadOnlyList<WorkItem> WorkItems { get; set; } = [];

    [Parameter]
    public IReadOnlyList<WorkItem> DoneItems { get; set; } = [];

    [Parameter]
    public string? GitHubLogin { get; set; }

    [Parameter]
    public string? JiraDisplayName { get; set; }

    [Parameter]
    public SprintInfo? ActiveSprint { get; set; }

    [Parameter]
    public DateTimeOffset? LastRefreshed { get; set; }

    [Parameter]
    public bool IsLoading { get; set; }

    private static string FormatTimeAgo(DateTimeOffset dt)
    {
        var ago = DateTimeOffset.UtcNow - dt;
        return ago.TotalMinutes < 1 ? "just now"
            : ago.TotalMinutes < 60 ? $"{(int)ago.TotalMinutes}m ago"
            : ago.TotalHours < 24 ? $"{(int)ago.TotalHours}h ago"
            : $"{(int)ago.TotalDays}d ago";
    }
}
